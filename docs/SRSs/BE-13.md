### PHẦN 1: TÀI LIỆU KỸ THUẬT (SRS) CHO TICKET [BE-13]

#### **Ticket: [BE-13] Record Transaction (Ghi nhận đóng tiền)**

**1. Thông tin chung**

* **Assignee:** Backend Dev
* **Branch Name:** `feature/BE-13-record-transaction`
* **Estimated Time:** 3h

**2. Mô tả (Description)**
API lưu trữ giao dịch khi người dân đóng tiền. Đây là hành động xác nhận "Đã đóng tiền".

**3. Yêu cầu kỹ thuật (Technical Specs)**

*   **Endpoint:** `POST /api/transactions`
*   **Authentication:** Yêu cầu `Bearer Token`.
*   **Payload:**
    ```json
    {
      "apartmentId": "apt_id_123",
      "feeId": "fee_id_456",
      "totalAmount": 500000,
      "payerName": "Nguyen Van A" // Người đi đóng tiền
    }
    ```

**4. Business Logic**

1.  **Duplicate Check (Quan trọng):**
    *   Kiểm tra trong collection `Transactions`: Có bản ghi nào trùng `apartmentId` VÀ `feeId` không?
    *   *Ngoại lệ:* Nếu `Fee.type` là `Contribution` (Tự nguyện), có thể cho phép đóng nhiều lần (VD: Đóng góp 2 lần).
    *   Nếu `Fee.type` là `Service` (Bắt buộc), **TUYỆT ĐỐI** chỉ cho phép 1 transaction thành công duy nhất. Nếu đã có -> Trả về lỗi `409 Conflict`.
2.  **Create Transaction:**
    *   Tạo bản ghi mới với `date` = `Date.now()`.
    *   Lưu `createdBy` = `req.user.id` (Admin thực hiện thu tiền).
3.  **Response:** Trả về thông tin biên lai.

**5. Acceptance Criteria**

* [ ] **Duplicate Prevention:** Ngăn chặn đóng 2 lần cho phí bắt buộc.
* [ ] **Data Validation:** `totalAmount` phải > 0. `payerName` không được để trống.
* [ ] **Recording:** Lưu đúng thông tin người đóng và người thu (Admin).
* [ ] **Response:** Trả về `201 Created`.

**6. Error Codes**

*   `409 Conflict`: "Fee already paid for this apartment".
*   `400 Bad Request`: "Invalid amount".
