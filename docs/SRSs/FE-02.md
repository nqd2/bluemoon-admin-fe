# FE-02: Quản lý Nhân khẩu (Resident Management)

## 1. Tổng quan

Module này cung cấp chức năng quản lý cư dân (nhân khẩu) trong chung cư. Cho phép quản trị viên xem danh sách, thêm mới, cập nhật thông tin và xóa nhân khẩu khỏi hệ thống.
Tương ứng với các ticket Backend: `BE-04`, `BE-05`, `BE-06`.

## 2. Đặc tả giao diện (UI Specifications)

### Các thành phần (Components)

- **Resident List (Bảng danh sách)**:

  - **Cột (Columns)**:
    - `Họ tên` (fullName)
    - `CCCD/CMND` (identityCard)
    - `Giới tính` (gender)
    - `Ngày sinh` (dob - Định dạng: DD/MM/YYYY)
    - `Nghề nghiệp` (job)
    - `Trạng thái` (status - Vd: Tạm trú, Thường trú)
    - **Hành động**: Nút Sửa (Icon), Nút Xóa (Icon)
  - **Bộ lọc/Tìm kiếm**: Tìm theo Tên hoặc CCCD.
  - **Phân trang**: Trang trước/sau hoặc số trang.

- **Resident Form (Modal hoặc Trang riêng)**:
  - **Input Fields**:
    - `Họ tên`: Text Input.
    - `Ngày sinh`: Date Picker.
    - `Giới tính`: Select (Nam/Nữ/Khác).
    - `CCCD/CMND`: Text Input (Chỉ số).
    - `Quê quán` (Hometown): Text Input.
    - `Nghề nghiệp` (Job): Text Input.
    - `Trạng thái` (Status): Select (Thường trú/Tạm trú... - thường dùng cho Edit).

### Ánh xạ dữ liệu (Data Mapping)

| Nhãn trường (Label) | Tên biến FE    | Key Payload (API) | Kiểu   | Ghi chú           |
| :------------------ | :------------- | :---------------- | :----- | :---------------- |
| Họ tên              | `fullName`     | `fullName`        | String | Bắt buộc          |
| Ngày sinh           | `dob`          | `dob`             | Date   | Bắt buộc          |
| Giới tính           | `gender`       | `gender`          | String | "Nam" / "Nữ"      |
| CCCD/CMND           | `identityCard` | `identityCard`    | String | Duy nhất (Unique) |
| Quê quán            | `hometown`     | `hometown`        | String |                   |
| Nghề nghiệp         | `job`          | `job`             | String |                   |

## 3. Luồng xử lý & Tương tác (Flow & Interaction)

### 3.1. Xem danh sách (Luồng chính)

1. User truy cập `/residents`.
2. **Server Component** gọi API `GET ${process.env.BACKEND_URL}/api/residents`.
3. Hiển thị dữ liệu lên **ResidentTable**.
4. Phân trang: User click "Trang 2" -> Update URL query param `?page=2` -> Server Component fetch lại data.

### 3.2. Thêm mới Nhân khẩu

1. User click "Thêm Nhân khẩu" -> Mở Modal/Form.
2. Nhập thông tin.
3. Click "Lưu".
4. Gọi API `POST /api/residents`.
5. Thành công: Đóng modal, Refresh danh sách (revalidateTag hoặc router.refresh), Hiện Toast "Thêm thành công".
6. Lỗi: Hiển thị lỗi validate (ví dụ: "CCCD đã tồn tại").

### 3.3. Sửa Nhân khẩu

1. Click "Sửa" trên một dòng.
2. Lấy chi tiết (hoặc dùng data từ dòng đó) và điền vào Form.
3. User sửa dữ liệu (ví dụ: Nghề nghiệp).
4. Click "Cập nhật".
5. Gọi API `PUT /api/residents/:id`.
6. Thành công: Refresh danh sách, Hiện Toast.

### 3.4. Xóa Nhân khẩu

1. Click "Xóa" -> Hiện Dialog xác nhận ("Bạn có chắc chắn muốn xóa?").
2. Xác nhận -> Gọi API `DELETE /api/residents/:id`.
3. Thành công: Xóa dòng khỏi bảng/Refresh danh sách.

## 4. Chi tiết triển khai kỹ thuật (Technical Implementation Details)

### API Endpoints

- **List**: `GET /api/residents?page={page}&limit={limit}&keyword={keyword}`
- **Create**: `POST /api/residents`
- **Update**: `PUT /api/residents/:id`
- **Delete**: `DELETE /api/residents/:id`

### Ghi chú triển khai

- **Server Components**: Sử dụng cho trang Danh sách để fetch dữ liệu ban đầu.
- **Server Actions**: Sử dụng cho các hành động `createResident`, `updateResident`, `deleteResident`.
- **Loading State**: Sử dụng `<Suspense>` cho bảng hoặc `useTransition` khi tìm kiếm/phân trang.
- **Validation**: Sử dụng `zod` ở client (phản hồi form) và server (validate trong action).

## 5. Git Branch

**Branch name**: `feature/FE-02-resident-management`