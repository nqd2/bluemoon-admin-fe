# FE-05: Quản lý Giao dịch (Transaction Management)

## 1. Tổng quan

Module này hỗ trợ ghi nhận việc đóng phí. Quản trị viên sử dụng để tính toán số tiền cần đóng cho một hộ cụ thể và ghi nhận giao dịch thành công.
Tương ứng với các ticket Backend: `BE-12`, `BE-13`.

## 2. Đặc tả giao diện (UI Specifications)

### Các thành phần (Components)

- **Record Payment Page (Ghi nhận đóng phí)**:
  - **Chọn Căn hộ**: Dropdown có tìm kiếm.
  - **Chọn Khoản thu**: Dropdown có tìm kiếm (Lý tưởng là hiện các khoản chưa đóng, hoặc tất cả).
  - **Khu vực Tính toán (Calculation Area)**:
    - Hiển thị `Đơn giá`, `Số lượng` (Vd: Diện tích căn hộ), và `Thành tiền`.
    - Nút: "Tính toán" (Calculate) (hoặc tự động tính khi chọn xong).
  - **Chi tiết Thanh toán**:
    - `Tổng tiền` (Read-only hoặc Editable nếu cho phép).
    - `Người nộp` (Text Input).
  - **Hành động**: "Xác nhận Thanh toán".

### Ánh xạ dữ liệu (Data Mapping)

| Nhãn trường (Label) | Tên biến FE   | Key Payload (API) | Kiểu   | Ghi chú           |
| :------------------ | :------------ | :---------------- | :----- | :---------------- |
| Căn hộ              | `apartmentId` | `apartmentId`     | ID     | Select            |
| Khoản thu           | `feeId`       | `feeId`           | ID     | Select            |
| Người nộp           | `payerName`   | `payerName`       | String |                   |
| Tổng tiền           | `totalAmount` | `totalAmount`     | Number | Kết quả tính toán |

## 3. Luồng xử lý & Tương tác (Flow & Interaction)

### 3.1. Quy trình Ghi nhận

1. **Chọn ngữ cảnh**: User chọn Căn hộ và Loại phí.
2. **Tính toán**:
   - Hệ thống tự động fetch hoặc User click "Tính toán".
   - Gọi `POST /api/transactions/calculate` với `{ apartmentId, feeId }`.
   - Hiển thị `totalAmount` trả về (Vd: 500,000 VND).
3. **Xác nhận**:
   - User nhập `Tên người nộp` (có thể auto-filled tên chủ hộ).
   - User click "Xác nhận Thanh toán".
   - Gọi `POST /api/transactions` với `{ apartmentId, feeId, totalAmount, payerName }`.
4. **Hoàn tất**:
   - Hiển thị Thông báo thành công.
   - Tùy chọn "In biên lai" (Tính năng tương lai).
   - Chuyển hướng về trang `Tình trạng phí` hoặc xóa form để nhập tiếp.

## 4. Chi tiết triển khai kỹ thuật (Technical Implementation Details)

### API Endpoints

- **Calculate (Tính toán)**: `POST /api/transactions/calculate`
  - Input: ApartmentID, FeeID.
  - Output: `{ totalAmount, formula }`.
- **Record (Ghi nhận)**: `POST /api/transactions`
  - Input: ApartmentID, FeeID, TotalAmount, PayerName.

### Logic Frontend

- **Quản lý State**: Cần lưu `Apartment` và `Fee` đã chọn để truyền vào hàm tính toán.
- **Tính toán bất đồng bộ**: Đảm bảo `Tổng tiền` được lấy từ logic Backend (đặc biệt các loại phí theo diện tích) chứ không phải do Frontend tự tính (để đảm bảo nhất quán).

## 5. Git Branch

**Branch name**: `feature/FE-05-transaction-management`